# Предсказание коэффициента восстановления золота

## Цель и основные шаги работы

**Цель работы**: подготовить прототип модели машинного обучения для «Цифры». Модель должна предсказать коэффициент восстановления золота из золотосодержащей руды.

**Основные шаги работы**:
1. Ознакомиться с данными, содержащимися в файлах;
1. Рассчитать показатель эффективности для операций флотации и очистки и сравненить с представленными значениями в DataFrame;
1. Сравненить признаки в тренировочной и тестовой выборках;
1. Предобработать данные:
    * Преобразовать тип данных;
    * Добавить целевые признаки в тестовую выборку;
    * Удалить лишние признаки;
    * Обработать пропущенные значения.
1. Проанализировать концентрацию металлов (Au, Ag, Pb) на различных этапах очистки;
1. Построить и проанализировать распределения размеров гранул сырья на обучающей и тестовой выборках;
1. Проанализировать суммарную концентрация всех веществ на разных стадиях;
1. Построить модель для предсказания recovery:
    * Провести стандаризацию данных;
    * Выбрать и построить модель;
    * Подобрать гиперпараметры для улучшения модели;
    * Проверить качество модели на тестовой выборке;
    * Проверить модель на адекватность.
1. Написать общий вывод к работе.

## Описание данных

**Технологический процесс**
* исходное сырье
* флотационные реагенты:
 * ксантогенат;
 * сульфат;
 * депрессант (силикат натрия).
* флотация
* отвальные хвосты
* флотационная установка
* очистка
* черновой концентрат золота
* финальный концентрат золота

**Параметры этапов**
* объём воздуха
* уровень жидкости
* размер гранул сырья
* скорость подачи

## Использумый стек
Python, pandas, matplotlib, seaborn, sklearn

## Вывод
В результате проделанной работы удалось получиьб следующие результаты.

***1.) Построили гистограммы концентрации золота, серебра и свинца на различных этапах очистки.*** 

*Концентрация **Au** на различных этапах очистки:*

**Метрики**  | **Сырье** | **После флотации** | **После первичной очистки** | **Финальная концентрация**
:-------------: | :-------------: | :-------------: | :-------------: | :-------------: |
Среднее значение       | 7.54 | 17.83 | 29.11 | 39.89 |
Медиана                | 7.87 | 19.99 | 32.34 | 44.63 |
Стандартное отклонение | 3.04 | 6.84  | 10.65 | 13.54 |  

*Концентрация **Ag** на различных этапах очистки:*

**Метрики**  | **Сырье** | **После флотации** | **После первичной очистки** | **Финальная концентрация**
:-------------: | :-------------: | :-------------: | :-------------: | :-------------: |
Среднее значение       | 8.04 | 10.84 | 7.66 | 4.76 |
Медиана                | 8.29 | 11.77 | 8.25 | 4.94 |
Стандартное отклонение | 3.14 | 4.40  | 3.13 | 2.04 |

*Концентрация **Pb** на различных этапах очистки:*

**Метрики**  | **Сырье** | **После флотации** | **После первичной очистки** | **Финальная концентрация**
:-------------: | :-------------: | :-------------: | :-------------: | :-------------: |
Среднее значение       | 3.28| 6.88 | 8.80 | 9.07 |
Медиана                | 3.41 | 7.57 | 9.88 | 9.91 |
Стандартное отклонение | 1.46 | 2.83  | 3.79 | 3.26 |  

 
***2.) Сравнили распределения размеров гранул сырья на обучающей и тестовой выборках до флотации и после***

*Размер гранул сырья для обучающей и тестовой выборок **до флотации**:*

**Метрики**  | **Train** | **Test** |
:-------------: | :-------------: | :-------------: |
Среднее значение       | 60.18 | 55.89 |
Медиана                | 54.06 | 49.96 |
Стандартное отклонение | 30.52 | 22.70 |  

Средние значения и стандартные значения практически одинаковы. Гистограммы очень похожи. Поэтому считаем, что распределения одинаковы.

*Размер гранул сырья для обучающей и тестовой выборок **до первичной очистки**:*

**Метрики**  | **Train** | **Test** |
:-------------: | :-------------: | :-------------: |
Среднее значение       | 7.31 | 7.25 |
Медиана                | 7.29 | 7.25 |
Стандартное отклонение | 0.61 | 0.61 |  

Средние значения и стандартные значения практически одинаковы. Гистограммы очень похожи. Поэтому считаем, что распределения одинаковы.



***3.) Сравнили суммарную концентрацию всех веществ на разных стадиях***

*Суммарная концетрация веществ на различных этапах:*

**Метрики**  | **Концентрация в сырье** | **Черновая концентрация** | **Финальная концентрация** |
:-------------: | :-------------: | :-------------: | :-------------: |
Среднее значение       | 20.70 | 40.01 | 59.29 |
Медиана                | 20.21 | 40.38 | 60.26 |
Стандартное отклонение | 4.67 | 4.77 | 5.15 |

***4.) Построили модели для предсказаний recovery***  
Построили 2 модели: одну для предсказания **rougher.output.recovery**, другую для предсказания **final.output.recovery**. Получили следующие значения метрики sMAPE.

**Модель**  | **sMAPE rougher** | **sMAPE final** | **sMAPE total** |
:-------------: | :-------------: | :-------------: | :-------------: |
Decision Tree Regressor      | 11.64 | 16.17 | 15.04 |
Random Forest Regressor      | 8.39 | **11.19** | 10.49 |
Linear Regression | **7.66** | 11.92 | 10.86 |


Лучшая модель для предсказания **rougher.output.recovery** оказалась **Linear Regression** со значением метрики **sMAPE rougher = 7.66**;  
Лучшая модель для предсказания **final.output.recovery** оказалась **Random Forest Regressor** со значением метрики **sMAPE final = 11.19**.


Подобрали гиперпаратры для **Random Forest Regressor** и предсказания **final.output.recovery**. Лучшее значение **sMAPE_final = 9.60** показала модель со следующими гипермараметрами: 
* n_estimators = 15;
* max_depth = 5.

Получили значения метрики **sMAPE total = 10.19** для тренировочной выборки для следующих конфигураций моделей:
 * **Linear Regression** для **rougher.output.recovery**;
 * **Random Forest Regressor** (n_estimators = 15, max_depth = 5) для **final.output.recovery**.


Получили значения метрики **sMAPE total = 8.11** для тестовой выборки.  

Проверили модель на адекватность. Для константной модели получили значение метрики **sMAPE total = 8.29**, что немного больше, чем для нашей модели, но позволяет сделать вывод, что модель адекватна.