# Определение стоимости автомобилей

## Цель и основные шаги работы

**Цель работы**: построить модель для определения рыночной стоимости автомобиля. Основные критерии работы модели:
* качество предсказания;
* скорость предсказания;
* время обучения.

**Основные шаги работы**:
1. Ознакомиться с данными, содержащимися в файле autos.csv;
1. Предобработать данные:
    * Обработать дубликаты;
    * Удалить лишние признаки;
    * Переименовать признаки;
    * Обработать пропущенные значения.
    * Обработать количественные признаки.
1. Подготовить данные к обучению моделей:
    * Выполнить Ordinal Encoding;
    * Разделить выборки;
    * Провести стандартизацию данных.
1. Построить модели с подбором гиперпараметров:
    * LinearRegression;
    * CatBoostRegressor;
    * LGBMRegressor.
1. Выбрать лучшую модель и проверить ее на тестовой выборке и на адекватность.
1. Написать общий вывод к работе.

## Описание данных

**Признаки**
* дата скачивания анкеты из базы
* тип автомобильного кузова
* год регистрации автомобиля
* тип коробки передач
* мощность (л. с.)
* модель автомобиля
* пробег (км)
* месяц регистрации автомобиля
* тип топлива
* марка автомобиля
* была машина в ремонте или нет
* дата создания анкеты
* количество фотографий автомобиля
* почтовый индекс владельца анкеты (пользователя)
* дата последней активности пользователя  


**Целевой признак**
* цена (евро)
 
## Использумый стек
Python, pandas, matplotlib, numpy, sklearn, catboost, lightgbm

## Вывод

В результате статистического анализа признаков удалось установить следующее:  

**КАТЕГОРИАЛЬНЫЕ ПРИЗНАКИ**  

***1.) Топ 3 типа кузова автомобилей***

**Тип кузова**  | **Доля от общего количнства** | 
:-------------: | :-------------: |
sedan       | 0.25 | 
small       | 0.22 |
wagon       | 0.18 |

***2.) Тип коробки передач***

**Тип коробки передач**  | **Доля от общего количнства** | 
:-------------: | :-------------: |
manual       | 0.76 | 
auto       | 0.19 |
unknow       | 0.05 |

***3.) Топ 3 типа топлива***

**Тип топлива**  | **Доля от общего количнства** | 
:-------------: | :-------------: |
petrol       | 0.61 | 
gasoline     | 0.28 |
unknow       | 0.09 |

***4.) Топ 5 автопроизводителей***

**Автопроизводитель**  | **Доля от общего количнства** | 
:-------------: | :-------------: |
volkswagen       | 0.22 | 
opel     | 0.11 |
bmw       | 0.10 |
mercedes_benz       | 0.09 |
audi       | 0.08 |
ford       | 0.07 |

***5.) Производился ли ремонт***

**Ремонт**  | **Доля от общего количнства** | 
:-------------: | :-------------: |
no       | 0.70 | 
unknow     | 0.20 |
yes       | 0.10 |

**КОЛИЧЕСТВЕННЫЕ ПРИЗНАКИ** 

***1.) Год регитрации автомобиля***

**Метрики**  | **Значение** | 
:-------------: | :-------------: |
Среднее значение       | 2003 |
Медиана                | 2003 |
Стандартное отклонение | 7.37 |


***2.) Мощность***

**Метрики**  | **Значение** | 
:-------------: | :-------------: |
Среднее значение       | 120 |
Медиана                | 110 |
Стандартное отклонение | 53.29 |

***3.) Пробег***

**Метрики**  | **Значение** | 
:-------------: | :-------------: |
Среднее значение       | 150000 |
Медиана                | 150000 |
Стандартное отклонение | 36731 |

***4.) Цена***

**Метрики**  | **Значение** | 
:-------------: | :-------------: |
Среднее значение       | 4555 |
Медиана                | 2890 |
Стандартное отклонение | 4515 |

Таким образом, **среднестатистическое объявление**:

**Параметр**  | **Значение** | 
:-------------: | :-------------: |
Автопроизводитель | volkswagen |
Модель | golf |
Тип кузов автомобиля       | седан |
Тип коробки передач                | механика |
Тип топлива | бензин |
Год регистрации | 2003 |
Мощность | 110 |
Пробег | 150000 |
Производился ремонт  | нет |
Цена | 2890 |


Обучили 3 модели с разными значениями гиперпараметров:
1. LinearRegression со стандартными гиперпараметрами;
2. CatBoostRegressor с гиперпараметрами: 
    * *iteration* = [10, 30, 50, 70, 90, 110];
    * *depth* = [3, 5, 7, 9].
3. LightGBM с гиперпараметрами: 
    * *n_estimators* = [10, 30, 50, 70, 90];
    * *max_depth* = [3, 5, 7];
    * *rate* = [0.01, 0.1, 1.0].
    

Лучшие модели по RMSE:

**Модель**  | **Время обучения, с** | **Время предсказания, c** | **RMSE_valid** | **Гиперпараметры** | 
:-------------: | :-------------: | :-------------: | :-------------: | :-------------: |
LinearRegression       | 0.035 | 0.012 | 2938 | - |
CatBoostRegressor      | 23.44 | 0.013 | 1942 | 'iteration': 110, 'depth': 9 |
LGBMRegressor          | 4.699 | 0.502 | 1718 | 'rate': 1.0, 'n_estimators': 90, 'depth': 7 |

LinearRegression очень быстро обучается и предсказывает, но имеет очень плохой RMSE. CatBoostRegressor очень долго обучается, но быстро предсказывает и имеет неплохое начение RMSE. LGBMRegressor достаточно быстро обучается, имеет лучшее значение RMSE, но намного дольше предсказывает, чем другие модели.  

Так как заказчику важны:
1. качество предсказания;
2. скорость предсказания;
3. время обучения.

То предлагаю выбрать следующую модель:

**Модель**  | **Время обучения, с** | **Время предсказания, c** | **RMSE_valid** | **Гиперпараметры** | 
:-------------: | :-------------: | :-------------: | :-------------: | :-------------: |
LGBMRegressor          | 1.899 | 0.213 | 1812 | 'rate': 1.0, 'n_estimators': 30, 'depth': 5 |

Данную модель предлагаю выбрть, так как она содержит наиболее оптимальные значения времени обучения и предсказания с очень неплохим значением RMSE.

Результаты проверки выбранной модели на тестовой выборке.

**Модель**  | **Время обучения, с** | **Время предсказания, c** | **RMSE_test** | **Гиперпараметры** | 
:-------------: | :-------------: | :-------------: | :-------------: | :-------------: |
LGBMRegressor          | 2.36 | 0.21 | 1810 | 'rate': 1.0, 'n_estimators': 30, 'depth': 5 |

Модель адекватна, так как:
 * Значение метрики RMSE для стандартной модели (среднее значение): 4578.73
 * Значение метрики RMSE для стандартной модели (медиана): 4885.50    