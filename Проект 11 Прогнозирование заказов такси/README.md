# Прогнозирование заказов такси

## Цель и основные шаги работы

**Цель работы**: построить модель для предсказания количества заказов такси в аэропорт на следущий час с значением RMSE < 48.

**Основные шаги работы**:
1. Ознакомиться с данными, содержащимися в файле taxi.csv:
    * Поиск пропущенных данных;
    * Проверка данных на монотонность;
    * выполнить ресеплирование данных по каждому часу.
1. Проанализировать данные:
    * Анализ всего временного ряда;
    * Построить графики тренда, сезонности и шумов всего временного ряда;
    * Построить графики тренда, сезонности и шумов для промежутка 1 месяц;
    * Построить графики тренда, сезонности и шумов для промежутка 1 неделя.
1. Выбрать, создать и добавить признаки в DataFrame;
1. Построить модели с подбором гиперпараметров:
    * RandomForestRegressor;
    * DecisionTreeRegressor;
    * CatBoostRegressor;
    * LGBMRegressor.
1. Выбрать лучшую модель и проверить ее на тестовой выборке и на адекватность.
1. Написать общий вывод к работе.
 
## Использумый стек
Python, pandas, matplotlib, numpy, sklearn, catboost, lightgbm, statsmodels

## Вывод

***============================= АНАЛИЗ ДАННЫХ =============================*** 

**ДАННЫЕ ПО ВСЕМУ ВРМЕНОМУ РЯДУ**
* Среднее значение количества заказов такси в аэропорту с каждым месяцем растет. Особенный рост начинается в летних месяцах (многие летят в отпуск);
* В целом сигма на всем протяжении постоянна, но наблюдается скачок в середине августа (многие начали возвращаться из отпуска);
* Так как сигма и среднее значение с течением времени меняется, то мы имеем дело с нестационарым рядом.

**ТРЕНД, СЕЗОННОСТЬ И ШУМЫ ВСЕГО ВРЕМЕННОГО РЯДА**
* По графику тренда отчетливо прослеживается тенденция увеличения числа заказов такси; 
* Очень сложно оценивать сезоность по всему графику, но видно, что есть повторяющиеся фрагменты.  

**ТРЕНД, СЕЗОННОСТЬ И ШУМЫ ДЛЯ ПРОМЕЖУТКА 1 МЕСЯЦ**
* В марте 2018 года выходными были следующие дни:  
    * 3, 4;
    * 8 - 11;
    * 17, 18;
    * 24, 25. 
    
По графику тренда отчетливо прослеживается тенденция увеличения числа заказов такис в аэропорт накануне выходных дней. 
* Также можно более отчетливо увидеть сезонность. Количество заказов такси ночью минимально, днем оно среднее и к вечеру достигает своего пика.

**ТРЕНД, СЕЗОННОСТЬ И ШУМЫ ДЛЯ ПРОМЕЖУТКА 1 НЕДЕЛЯ**
* По графику тренда видно, что число заказов такси в аэропорт минимально в понедельник и достигает своего пика около 15 часов пятницы. Число заказов такси в течении недели плавно увеличивается.



***============================= ОБУЧЕНИЕ МОДЕЛЕЙ =============================***  
Обучили 4 модели с подбором гиперпарамтеров:
* RandomForestRegressor;
* DecisionTreeRegressor;
* CatBoostRegressor;
* LGBMRegressor.

Получили следующие результаты:  

**Модель**  | **RMSE** | **Гиперпараметры** | 
:-------------: | :-------------: | :-------------: |
RandomForestRegressor      | 25.220840 | 'max_depth': 17, 'n_estimators': 130 |
DecisionTreeRegressor      | 29.105964 | 'max_depth': 7 |
CatBoostRegressor          | 26.083369 | 'depth': 7, 'iterations': 200 |
LGBMRegressor              | 25.099336 | 'learning_rate': 0.1, 'max_depth': 7, 'n_estimators': 100 |

Лучшей моделью оказалась **LGBMRegressor** с значением RMSE = **25.1** с гиперпараметрами: **'learning_rate': 0.1, 'max_depth': 7, 'n_estimators': 100**.



***============================= ПРОВЕРКА МОДЕЛЕЙ НА ТЕСТОВЫХ ДАННЫХ =============================***

Проверили модели на тестовых данных и получились следующие результаты:

**Модель**  | **RMSE** | **Гиперпараметры** | **RMSE_test** | 
:-------------: | :-------------: | :-------------: | :-------------: |
RandomForestRegressor      | 25.220840 | 'max_depth': 17, 'n_estimators': 130 | 46.302494  |
DecisionTreeRegressor      | 29.105964 | 'max_depth': 7 | 55.094100  |
CatBoostRegressor          | 26.083369 | 'depth': 7, 'iterations': 200 | 49.780403  |
LGBMRegressor              | 25.099336 | 'learning_rate': 0.1, 'max_depth': 7, 'n_estimators': 100 | 44.753079  |

Значения метрики RMSE на тестовых данных для всех моделей упали, но лучшей все равно остается модель **LGBMRegressor** с значением RMSE = **44.75**.  

По заданию требовалось, что значение RMSE должно быть меньше 48. Выбранная модель обеспечивает такое значение метрики RMSE.

Лучашя моделью оказалась **LGBMRegressor**.

**Модель**  | **RMSE** | **Гиперпараметры** | **RMSE_test** | 
:-------------: | :-------------: | :-------------: | :-------------: |
LGBMRegressor              | 25.099336 | 'learning_rate': 0.1, 'max_depth': 7, 'n_estimators': 100 | 44.753079  |

Модель адекватна, так как:
 * Значение метрики RMSE для стандартной модели (среднее значение): 84.81
 * Значение метрики RMSE для стандартной модели (медиана): 87.24  