# Телеком

## Цель и основные шаги работы

**Цель работы**: разработать модель, которая сможет прогнозировать отток клиентов для оператора связи "Ниединогоразрыва.ком".

**Основные шаги работы:**  
1. Подготовка данных:
    * Ознакомится с данными, содержащихся в файлах;
    * Поиск и обработка пропущенных значений;
    * Обработка дубликатов;
    * Объединение таблиц в один DataFrame и обработка пропущенных значений после объединения;
    * Замена типа данных;
    * Выделение целевого признака;
    * Добавление признаков;
    * Удаление бесполезных признаков;
2. Исследовательский анализ данных:
    * Распределение целевого признака
    * Построение гистограмм и диаграмм размаха признаков;
3. Обучение моделей:
    * Кодирование Ordinal Encoding;
    * Проверка признаков на мультиколинеарность;
    * Разделение выборок на обучающую и тестовую с учетом дисбаланса классов;
    * Обучение моделей:
         * LogisticRegression;
         * DecisionTreeClassifier;
         * RandomForestClassifier;
         * LinearSVC;
         * CatBoostClassifier;
         * LGBMClassifier.
    * Подбор гиперпараметров для лучшей модели для улучшения метрики AUC-ROC;
    * Проверка значимости признаков.
4. Общий вывод.

## Использумый стек
Python, pandas, matplotlib, numpy, sklearn, catboost, lightgbm

## Вывод
===================================== **ИССЛЕДОВАТЕЛЬСКИЙ АНАЛИЗ ДАННЫХ** =====================================  
**1) Дисбаланс классов.**  

В данных наблюдается дисбаланс классов.

**Exited**  | **Ratio**
:-------------: | :-------------:
0   |   0.73463
1  |   0.26537

**2) Категориальные признаки.**  

В целом ушедшие и не ушедшие клиенты ведут себя одинаково. Но есть некоторые отличия:  
* Ушедшие клиенты чаще исупользовали *InternetService* = Fiber optic. Возможно, качество оптоволоконной линии их не устраивало или конкуренты предоставляют более выгодные тарифы по данной технологии подключения;
* Ушедшие клиенты чаще использовали *PaperlessBilling* (безналичный расчет), чем не ушедшие;
* Намного чаще ушедшие клиенты использовали *PaymentMethod* = Electronic check. Возможно сервис оплаты был не слишком удобен или была коммисия при оплате;
* Большинство ушедших клиентов использовали *Type* = Month-to-month (помесячный тип оплаты). Возможно клиенты пользовались услугами связи несколько месяцев и уходил, так как их что-то не устраивало и им было невыгодно заключать годичные контракты.

**3) Непрерывные признаки.**

В предыдущем пункте выяснили, что большинство ушедших клиентов использовали *Type* = Month-to-month (помесячный тип оплаты). Возможно клиенты пользовались услугами связи несколько месяцев и уходил, так как их что-то не устраивало и им было невыгодно заключать годичные контракты.  
Это предположение подтверждается гистограмами "Суммарных платежей пользователя за все время" и "Количетсва дней дейсвтия контракта". Действительно, большинство ушедших клиентов мало пользовались услугами компании.

**4) Сравнение ушедшего и не ушедшего клиента (по средним значениям).**

**Признак**  | **Ушедший клиент**  | **Не ушедший клиент**
:-------------: | :-------------: | :-------------:
MonthlyCharges   |   74.44  |   61.26
TotalCharges  |   1531.79  |   2549.91
days  |   547.35  |   1144.44

================================================================================================================

============================================= **ПОСТРОЕНИЕ МОДЕЛЕЙ** =============================================  
**1) Проверка на мультиколинеарность.**

Между собой с коэффициентом корреляции **0.826** коррелируют два признака *days* и *TotalCharges*. При построении модели признак *TotalCharges* удалили, поэтому в дальнейшем можно его не выгружать при использовании модели. 

**2) Обучение моделей.**

Обучили 6 моделей: 
* LogisticRegression;
* DecisionTreeClassifier;
* RandomForestClassifier;
* LinearSVC;
* CatBoostClassifier;
* LGBMClassifier.


Metrics | LogisticRegression | DecisionTreeClassifier | RandomForestClassifier | LinearSVC | CatBoostClassifier | LGBMClassifier
    :-------------: | :-------------: | :-------------: | :-------------: | :-------------: | :-------------: | :-------------:
Accuracy |	0.80 |	0.77|	0.80|	0.79|	0.87|	0.84
Recall|	0.53|	0.57|	0.49|	0.53|	0.63|	0.60|
Precission|	0.66|	0.57|	0.67|	0.63|	0.84|	0.75
F1|	0.59|	0.57|	0.57|	0.58|	0.72|	0.67
AUC-ROC|	0.84|	0.71|	0.84|	0.83|	**0.91**|	0.89

Лучшей моделью оказалась **CatBoostClassifier** со значением **AUC-ROCK = 0.91**. Попробуем еще улучшить метрику с помощью подбора гиперпараметров.

**3) Подбор гиперпараметров.** 

Для лучшей модели при помощи `GridSearchCV` подбирали гиперпараметры. Параметры подбирали для такой сетки:
* 'depth': range(1, 11, 2),
* 'iterations':range(100, 1300, 200).

Лучшая модель получилась со следующими гиперпараметрами:
 * depth = 5;
 * iterations = 900.
 
На такой модели получили **AUC-ROCK = 0.91**, что и было до подбора гиперпараметров.  

**4) Проверка значимости признаков.**

feature | coeff
:-------------: | :-------------:
days|	57.572653
MonthlyCharges|	11.353986
Type|	9.866740
InternetService|	5.336757
PaymentMethod|	3.074975
PaperlessBilling|	1.598206
TechSupport|	1.490018
MultipleLines|	1.482206
StreamingMovies|	1.334270
StreamingTV|	1.168860
gender|	1.097316
OnlineSecurity|	1.095108
SeniorCitizen|	0.984544
Dependents|	0.818348
OnlineBackup|	0.707683
Partner|	0.682905
DeviceProtection|	0.335427

Основной вклад вносит признак *days*, затем идет группа менее важных признаков: *MonthlyCharges*, *Type*, *InternetService*, *PaymentMethod*.    

Остальные признаки оказывают маленькое влияние на качетство модели.  

**5) Проверка качества модели при использовании только важных признаков.**

n_features|	AUC-ROC|	Accuracy|	Recall|	Precission|	F1
:-------------: | :-------------: | :-------------: | :-------------: | :-------------: | :-------------:
**1**|	**0.913781**|	0.869392|	0.507495|	1.000000|	0.673295
2|	0.905580|	0.865985|	0.591006|	0.859813|	0.700508
3|	0.914974|	0.867121|	0.605996|	0.849850|	0.707500
4|	0.917992|	0.867121|	0.608137|	0.847761|	0.708229
**5**|	**0.916257**|	**0.873935**|	**0.631692**|	**0.855072**|	**0.726601**
6|	0.916358|	0.868257|	0.612420|	0.848665|	0.711443
7|	0.917350|	0.871096|	0.616702|	0.857143|	0.717310
8|	0.916837|	0.868825|	0.618844|	0.845029|	0.714462
9|	0.912750|	0.867689|	0.620985|	0.838150|	0.713407
10|	0.916116|	0.876775|	0.640257|	0.859195|	0.733742
11|	0.912723|	0.872800|	0.633833|	0.848138|	0.725490
12|	0.915492|	0.876207|	0.638116|	0.858790|	0.732187
13|	0.911933|	0.873367|	0.631692|	0.852601|	0.725707
14|	0.911629|	0.873935|	0.635974|	0.851003|	0.727941
15|	0.912722|	0.872800|	0.638116|	0.844193|	0.726829
16|	0.911728|	0.872800|	0.627409|	0.854227|	0.723457
17|	0.910554|	0.869960|	0.627409|	0.841954|	0.719018

При добавлении только одного призака *days* можно добиться значения ROC-AUC = 0.91. Оптимальным же является использование 5 самых важных признаков (*days*, *MonthlyCharges*, *Type*, *InternetService*, *PaymentMethod*), чтобы добиться практически лучших значений по всем метрикам.